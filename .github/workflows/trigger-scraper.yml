name: Daily Hackathon Scraper (Starts at 6:30AM & Ends at 6:31:10secs )

on:
    schedule:
        # 6:30 AM IST = 1:00 AM UTC
        - cron: '0 1 * * *'
    workflow_dispatch: # this allows manual trigger from GitHub UI

jobs:
    scrape:
        runs-on: ubuntu-latest

        steps:
            - name: Wake server (3 times with 5s gap)
              run: |
                  for i in {1..3}; do
                    echo "Ping $i to /test..."
                    curl -s -o /dev/null -w "%{http_code}\n" https://coflow-backend-bcgk.onrender.com || true
                    sleep 5
                  done

            - name: Wait for 1 minute
              run: sleep 60

            - name: Trigger scraper
              run: |
                  curl -X POST https://coflow-backend-bcgk.onrender.com/api/hackathons \
                    -H "Content-Type: application/json" \
                    -d '{"pass": "bsp_hack"}'
