name: Daily Hackathon Scraper (Runs every 3-days at 6:30AM)

on:
    schedule:
        # Every 3 days at 6:30 AM IST (1:00 AM UTC)
        - cron: '0 1 */3 * *'
    workflow_dispatch: # this allows manual trigger from GitHub UI `Actions`

jobs:
    scrape:
        runs-on: ubuntu-latest

        steps:
            - name: Wake Render-server (3 req's with 5s gap)
              run: |
                  for i in {1..3}; do
                    echo "Ping $i to /test..."
                    curl -s -o /dev/null -w "%{http_code}\n" https://coflow-backend-bcgk.onrender.com || true
                    sleep 5
                  done

            - name: Wait for 1-min to get the Render-server UP
              run: sleep 60

            - name: Trigger scraper endpoint to start Scraping
              run: |
                  curl -X POST https://coflow-backend-bcgk.onrender.com/api/hackathons \
                    -H "Content-Type: application/json" \
                    -d '{"pass": "bsp_hack"}'
